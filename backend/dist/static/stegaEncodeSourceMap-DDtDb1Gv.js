import{i as x}from"./sanity-BZLxghBw.js";const W=/_key\s*==\s*['"](.*)['"]/;function Z(t){return typeof t=="string"?W.test(t.trim()):typeof t=="object"&&"_key"in t}function N(t){if(!Array.isArray(t))throw new Error("Path is not an array");return t.reduce((e,r,i)=>{const n=typeof r;if(n==="number")return`${e}[${r}]`;if(n==="string")return`${e}${i===0?"":"."}${r}`;if(Z(r)&&r._key)return`${e}[_key=="${r._key}"]`;if(Array.isArray(r)){const[o,s]=r;return`${e}[${o}:${s}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(r)}\``)},"")}const R={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},T={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function B(t){return`$${t.map(e=>typeof e=="string"?`['${e.replace(/[\f\n\r\t'\\]/g,r=>R[r])}']`:typeof e=="number"?`[${e}]`:e._key!==""?`[?(@._key=='${e._key.replace(/['\\]/g,r=>R[r])}')]`:`[${e._index}]`).join("")}`}function Y(t){return t.map(e=>typeof e=="string"?`['${e.replace(/[\f\n\r\t'\\]/g,r=>R[r])}']`:typeof e=="number"?`[${e}]`:e._key!==""?`[?(@._key=='${e._key.replace(/['\\]/g,r=>R[r])}')]`:`[${e._index}]`)}function O(t){const e=[],r=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let i;for(;(i=r.exec(t))!==null;){if(i[1]!==void 0){const n=i[1].replace(/\\(\\|f|n|r|t|')/g,o=>T[o]);e.push(n);continue}if(i[2]!==void 0){e.push(parseInt(i[2],10));continue}if(i[3]!==void 0){const n=i[3].replace(/\\(\\')/g,o=>T[o]);e.push({_key:n,_index:-1});continue}}return e}function H(t){return t.map(e=>{if(typeof e=="string"||typeof e=="number")return e;if(e._key!=="")return{_key:e._key};if(e._index!==-1)return e._index;throw new Error(`invalid segment:${JSON.stringify(e)}`)})}function U(t){return t.map(e=>{if(typeof e=="string"||typeof e=="number")return e;if(e._index!==-1)return e._index;throw new Error(`invalid segment:${JSON.stringify(e)}`)})}function Q(t,e){if(!(e!=null&&e.mappings))return;const r=B(U(t));if(e.mappings[r]!==void 0)return{mapping:e.mappings[r],matchedPath:r,pathSuffix:""};const i=Y(U(t));for(let n=i.length-1;n>=0;n--){const o=`$${i.slice(0,n).join("")}`,s=e.mappings[o];if(s){const u=r.substring(o.length);return{mapping:s,matchedPath:o,pathSuffix:u}}}}function g(t){return t!==null&&Array.isArray(t)}function $(t,e,r=[]){if(g(t))return t.map((i,n)=>{if(x(i)){const o=i._key;if(typeof o=="string")return $(i,e,r.concat({_key:o,_index:n}))}return $(i,e,r.concat(n))});if(x(t)){if(t._type==="block"||t._type==="span"){const i={...t};return t._type==="block"?i.children=$(t.children,e,r.concat("children")):t._type==="span"&&(i.text=$(t.text,e,r.concat("text"))),i}return Object.fromEntries(Object.entries(t).map(([i,n])=>[i,$(n,e,r.concat(i))]))}return e(t,r)}function v(t,e,r){return $(t,(i,n)=>{if(typeof i!="string")return i;const o=Q(n,e);if(!o)return i;const{mapping:s,matchedPath:u}=o;if(s.type!=="value"||s.source.type!=="documentValue")return i;const h=e.documents[s.source.document],f=e.paths[s.source.path],d=O(u),y=O(f).concat(n.slice(d.length));return r({sourcePath:y,sourceDocument:h,resultPath:n,value:i})})}const tt="drafts",et="versions",E=".",V=`${tt}${E}`,nt=`${et}${E}`;function M(t){return t.startsWith(V)}function I(t){return t.startsWith(nt)}function rt(t){return!M(t)&&!I(t)}function it(t){if(!I(t))return;const[e,r,...i]=t.split(E);return r}function ot(t){return I(t)?t.split(E).slice(2).join(E):M(t)?t.slice(V.length):t}function st(t){const{baseUrl:e,workspace:r="default",tool:i="default",id:n,type:o,path:s,projectId:u,dataset:h}=t;if(!e)throw new Error("baseUrl is required");if(!s)throw new Error("path is required");if(!n)throw new Error("id is required");if(e!=="/"&&e.endsWith("/"))throw new Error("baseUrl must not end with a slash");const f=r==="default"?void 0:r,d=i==="default"?void 0:i,y=ot(n),k=Array.isArray(s)?N(H(s)):s,p=new URLSearchParams({baseUrl:e,id:y,type:o,path:k});if(f&&p.set("workspace",f),d&&p.set("tool",d),u&&p.set("projectId",u),h&&p.set("dataset",h),rt(n))p.set("perspective","published");else if(I(n)){const b=it(n);p.set("perspective",b)}const l=[e==="/"?"":e];f&&l.push(f);const w=["mode=presentation",`id=${y}`,`type=${o}`,`path=${encodeURIComponent(k)}`];return d&&w.push(`tool=${d}`),l.push("intent","edit",`${w.join(";")}?${p}`),l.join("/")}function at(t){let e=typeof t=="string"?t:t.baseUrl;return e!=="/"&&(e=e.replace(/\/$/,"")),typeof t=="string"?{baseUrl:e}:{...t,baseUrl:e}}const D=({sourcePath:t,resultPath:e,value:r})=>{if(pt(r)||dt(r))return!1;const i=t.at(-1);return!(t.at(-2)==="slug"&&i==="current"||typeof i=="string"&&(i.startsWith("_")||i.endsWith("Id"))||t.some(n=>n==="meta"||n==="metadata"||n==="openGraph"||n==="seo")||L(t)||L(e)||typeof i=="string"&&ct.has(i))},ct=new Set(["color","colour","currency","email","format","gid","hex","href","hsl","hsla","icon","id","index","key","language","layout","link","linkAction","locale","lqip","page","path","ref","rgb","rgba","route","secret","slug","status","tag","template","theme","type","textTheme","unit","url","username","variant","website"]);function pt(t){return/^\d{4}-\d{2}-\d{2}/.test(t)?!!Date.parse(t):!1}const ft=new Set(["app:","data:","discord:","file:","ftp:","ftps:","geo:","http:","https:","imap:","javascript:","magnet:","mailto:","maps:","ms-excel:","ms-powerpoint:","ms-word:","slack:","sms:","spotify:","steam:","teams:","tel:","vscode:","zoom:"]);function dt(t){try{const{protocol:e}=new URL(t,t.startsWith("/")?"https://acme.com":void 0);return ft.has(e)||e.startsWith("web+")}catch{return!1}}function L(t){return t.some(e=>typeof e=="string"&&e.match(/type/i)!==null)}const A=[8203,8204,8205,65279],S=A.map(t=>String.fromCharCode(t)),F=[8203,8204,8205,8290,8291,8288,65279,8289,119155,119156,119157,119158,119159,119160,119161,119162];Object.fromEntries(A.map((t,e)=>[t,e]));Object.fromEntries(F.map((t,e)=>[t,e.toString(16)]));const ut=String.fromCodePoint(A[0]).repeat(4),ht=[...A,...F];ht.map(t=>`\\u{${t.toString(16)}}`).join("");function yt(t){if(t===void 0)return"";const e=typeof t=="string"?t:JSON.stringify(t),r=new TextEncoder().encode(e);let i="";for(let n=0;n<r.length;n++){const o=r[n];i+=S[o>>6&3]+S[o>>4&3]+S[o>>2&3]+S[o&3]}return ut+i}function lt(t,e,r="auto"){return r===!0||r==="auto"&&!$t(t)&&!_t(t)?`${t}${yt(e)}`:t}function _t(t){try{return new URL(t,t.startsWith("/")?"https://example.com":void 0),!0}catch{return!1}}function $t(t){return!t||typeof t!="string"?!1:!!Date.parse(t)}const P=20;function kt(t,e,r){var h,f,d,y,k,p,l,w,b;const{filter:i,logger:n,enabled:o}=r;if(!o){const a="config.enabled must be true, don't call this function otherwise";throw(h=n==null?void 0:n.error)==null||h.call(n,`[@sanity/client]: ${a}`,{result:t,resultSourceMap:e,config:r}),new TypeError(a)}if(!e)return(f=n==null?void 0:n.error)==null||f.call(n,"[@sanity/client]: Missing Content Source Map from response body",{result:t,resultSourceMap:e,config:r}),t;if(!r.studioUrl){const a="config.studioUrl must be defined";throw(d=n==null?void 0:n.error)==null||d.call(n,`[@sanity/client]: ${a}`,{result:t,resultSourceMap:e,config:r}),new TypeError(a)}const s={encoded:[],skipped:[]},u=v(t,e,({sourcePath:a,sourceDocument:_,resultPath:m,value:c})=>{if((typeof i=="function"?i({sourcePath:a,resultPath:m,filterDefault:D,sourceDocument:_,value:c}):D({sourcePath:a,resultPath:m,value:c}))===!1)return n&&s.skipped.push({path:C(a),value:`${c.slice(0,P)}${c.length>P?"...":""}`,length:c.length}),c;n&&s.encoded.push({path:C(a),value:`${c.slice(0,P)}${c.length>P?"...":""}`,length:c.length});const{baseUrl:j,workspace:J,tool:q}=at(typeof r.studioUrl=="function"?r.studioUrl(_):r.studioUrl);if(!j)return c;const{_id:G,_type:X,_projectId:z,_dataset:K}=_;return lt(c,{origin:"sanity.io",href:st({baseUrl:j,workspace:J,tool:q,id:G,type:X,path:a,...!r.omitCrossDatasetReferenceData&&{dataset:K,projectId:z}})},!0)});if(n){const a=s.skipped.length,_=s.encoded.length;if((a||_)&&((y=(n==null?void 0:n.groupCollapsed)||n.log)==null||y("[@sanity/client]: Encoding source map into result"),(k=n.log)==null||k.call(n,`[@sanity/client]: Paths encoded: ${s.encoded.length}, skipped: ${s.skipped.length}`)),s.encoded.length>0&&((p=n==null?void 0:n.log)==null||p.call(n,"[@sanity/client]: Table of encoded paths"),(l=(n==null?void 0:n.table)||n.log)==null||l(s.encoded)),s.skipped.length>0){const m=new Set;for(const{path:c}of s.skipped)m.add(c.replace(W,"0").replace(/\[\d+\]/g,"[]"));(w=n==null?void 0:n.log)==null||w.call(n,"[@sanity/client]: List of skipped paths",[...m.values()])}(a||_)&&((b=n==null?void 0:n.groupEnd)==null||b.call(n))}return u}function C(t){return N(H(t))}var mt=Object.freeze({__proto__:null,stegaEncodeSourceMap:kt});export{v as encodeIntoResult,kt as stegaEncodeSourceMap,mt as stegaEncodeSourceMap$1};
